(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"TR+Y":function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),r=(a("14J3"),a("BMrR")),i=(a("+L6B"),a("2/Rp")),o=(a("miYZ"),a("tsqr")),l=a("d6i3"),s=a.n(l),c=a("gWZ8"),m=a.n(c),u=a("p0pE"),h=a.n(u),d=a("1l/V"),g=a.n(d),f=a("2Taf"),p=a.n(f),y=a("vZ4D"),b=a.n(y),v=a("l4Ni"),k=a.n(v),Y=a("ujKo"),E=a.n(Y),x=a("rlhR"),C=a.n(x),S=a("MhPg"),F=a.n(S),M=(a("y8nQ"),a("Vl3Y")),w=(a("iQDF"),a("+eQT")),O=a("q1tI"),T=a.n(O),D=a("MuoO"),A=a("wd/R"),j=a.n(A),L=a("6TVj"),B=a.n(L),V=(a("OaEy"),a("2fM7")),H=(a("t3Un"),a("GcXL"),V["a"].Option);function P(e){var t=e.selectDataSource;Object(O["useEffect"])(function(){},[t]);var a=function(t,a){e.onSelect(a.props.item)};return t&&T.a.createElement(V["a"],{defaultValue:"all",onSelect:a,style:e.style,getPopupContainer:function(e){return e.parentElement}},T.a.createElement(H,{key:"option_all",value:"all",item:"all"},"\u5168\u90e8"),t.map(function(e){return T.a.createElement(H,{key:e.key,value:e.key,item:e},e.title)}))}var R=T.a.memo(P),z=a("qIgq"),I=a.n(z),W=(a("tU7J"),a("wFql")),q=a("MT78"),J=a.n(q),N=W["a"].Title,Q=W["a"].Text;function _(e){var t=Object(O["useState"])(null),a=I()(t,2),i=(a[0],a[1]),o=Object(O["useRef"])(null),l=e.dataSource;return Object(O["useEffect"])(function(){var e=J.a.init(o.current);return window.addEventListener("resize",function(){e.resize()}),o&&(e.clear(),e.setOption({title:{text:"\u7edf\u8ba1\u9ad8\u53d1\u6848\u5377\u524d\u5341\u9879",x:"center",textStyle:{color:"#666666",fontWeight:"normal",fontFamily:"MicrosoftYaHei"}},tooltip:{},xAxis:{data:l.data.map(function(e){return e.categoryName})},yAxis:{},series:[{name:"",type:"bar",data:l.data.map(function(e){return e.count}),barWidth:40,itemStyle:{color:"#4C5FC1"},barFontSize:12}]}),i(e)),function(){window.removeEventListener("resize",function(){e.resize()})}},[l]),T.a.createElement(n["a"],{bodyStyle:{padding:0,margin:0,paddingBottom:"3vh"},style:{background:"#fff",marginBottom:10},bordered:!1},T.a.createElement(N,{level:4,style:{textAlign:"center",margin:"20px",color:"#4C5FC1",fontWeight:"normal"}},l.unit.name),T.a.createElement(r["a"],{span:24,type:"flex",justify:"space-around"},T.a.createElement(r["a"],{span:5,type:"flex",style:{height:"43vh",marginBottom:"3vh"}},T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u6848\u5377\u603b\u6570"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.totalCount)),T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u5df2\u5904\u7f6e\u6848\u5377\u603b\u6570"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.finishCount)),T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u672a\u5904\u7f6e\u6848\u5377\u603b\u6570"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.unFinishCount)),T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u8d85\u65f6\u6848\u5377\u603b\u6570"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.timeOutCount)),T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u5904\u7406\u5b8c\u6210\u7387"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.processing)),T.a.createElement("div",{style:{textAlign:"center",marginLeft:"5%",marginRight:"5%",marginBottom:"5%",width:"40%",height:"30%",backgroundColor:"#F0F2F5"}},T.a.createElement(Q,{style:{lineHeight:"518%"}},"\u9ad8\u53d1\u6848\u5377"),T.a.createElement(N,{level:2,style:{margin:0,color:"#3A87E4",lineHeight:"61%"}},l.stats.highIncidenceCount))),T.a.createElement("div",{style:{width:"60%",height:"43vh",border:"1px solid rgba(217,217,217,1)",padding:"1%"}},T.a.createElement("div",{ref:o,style:{width:"100%",height:"100%"}}))))}var U,Z,G,K,X=T.a.memo(_),$=a("io9h"),ee=a("+n12"),te=a("Qyje"),ae=w["a"].RangePicker,ne=(U=M["a"].create(),Z=Object(D["connect"])(function(e){var t=e.fileStat;return{fileStat:t}}),U(G=Z((K=function(e){function t(e){var a;return p()(this,t),a=k()(this,E()(t).call(this,e)),a.getBarData=function(){var e=g()(s.a.mark(function e(t,n){var r,i,o,l,c,u,d,g,f,p,y,b;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r=C()(a),i=a.state,o=i.stateToken,l=i.isBreakpoint,a.setState({bottomLoading:!0}),!n){e.next=26;break}c=0;case 5:if(!(c<t.length)){e.next=23;break}if(u=t[c],!l){e.next=19;break}return e.next=10,Object($["a"])("/api/stats/histogram",{params:{unitId:u.key,endTime:j()(n[1]).format("YYYY/MM"),startTime:j()(n[0]).format("YYYY/MM")},headers:{Authorization:o}});case 10:if(d=e.sent,0!==d.status){e.next=16;break}g=d.value.map(function(e){return{unit:h()({},e.histogram.unit),data:m()(e.histogram.data),stats:h()({},e.stats,{processing:r.calculate(e.stats.finishCount,e.stats.totalCount)})}}),a.setState({barData:a.state.barData.concat(g)}),e.next=17;break;case 16:return e.abrupt("return",!1);case 17:e.next=20;break;case 19:return e.abrupt("return",!1);case 20:c++,e.next=5;break;case 23:a.setState({bottomLoading:!1}),e.next=46;break;case 26:f=0;case 27:if(!(f<t.length)){e.next=45;break}if(p=t[f],!l){e.next=41;break}return e.next=32,Object($["a"])("/api/stats/histogram",{params:{unitId:p.key,endTime:j()().format("YYYY/MM"),startTime:j()().format("YYYY/MM")},headers:{Authorization:o}});case 32:if(y=e.sent,0!==y.status){e.next=38;break}b=y.value.map(function(e){return{unit:h()({},e.histogram.unit),data:m()(e.histogram.data),stats:h()({},e.stats,{processing:r.calculate(e.stats.finishCount,e.stats.totalCount)})}}),a.setState({barData:a.state.barData.concat(b)}),e.next=39;break;case 38:return e.abrupt("return",!1);case 39:e.next=42;break;case 41:return e.abrupt("return",!1);case 42:f++,e.next=27;break;case 45:a.setState({bottomLoading:!1});case 46:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.handlePanelChange=function(e,t){a.setState({rangePickerValue:e,mode:["date"===t[0]?"month":t[0],"date"===t[1]?"month":t[1]]})},a.handleChange=function(e){a.setState({rangePickerValue:e},function(){console.log(a.state.rangePickerValue)})},a.state={barData:[],rangePickerValue:null,selectComponentFromValue:"all",bottomLoading:!1,stateToken:ee["v"],isBreakpoint:!0},a.selectComponentOnSelect=a.selectComponentOnSelect.bind(C()(a)),a.handleOnSearch=a.handleOnSearch.bind(C()(a)),a.handleDownload=a.handleDownload.bind(C()(a)),a}return F()(t,e),b()(t,[{key:"calculate",value:function(e,t){return e?(e/t).toFixed(2):"0"}},{key:"selectComponentOnSelect",value:function(e){var t=this;this.setState({selectComponentFromValue:e},function(){console.log(t.state.selectComponentFromValue)})}},{key:"handleOnSearch",value:function(){var e=this,t=this.state,a=t.selectComponentFromValue,n=t.rangePickerValue,r=this.props.fileStat.selectList,i=this;if(n){if("all"!==a)return Object($["a"])("/api/stats/histogram",{params:{unitId:a.key,startTime:j()(n[0]).format("YYYY/MM"),endTime:j()(n[1]).format("YYYY/MM")},headers:{Authorization:ee["v"]}}).then(function(t){if(0===t.status){var a=t.value.map(function(e){return{unit:h()({},e.histogram.unit),data:m()(e.histogram.data),stats:h()({},e.stats,{processing:i.calculate(e.stats.finishCount,e.stats.totalCount)})}});e.setState({barData:a})}else o["a"].error("\u7f51\u7edc\u51fa\u9519, \u8bf7\u91cd\u8bd5")});this.setState({barData:[]},function(){e.getBarData(r,n)})}else o["a"].error("\u67e5\u8be2\u65e5\u671f\u4e0d\u80fd\u4e3a\u7a7a")}},{key:"handleDownload",value:function(){var e,t=this.state,a=t.selectComponentFromValue,n=t.rangePickerValue,r=(this.props.dispatch,this.props.form.validateFields),i=new Headers({Authorization:ee["v"],Accept:"application/json","Content-Type":"application/json; charset=utf-8"}),l={method:"GET",headers:i};r(function(t,r){if(t)return!1;n?e="all"!==a?{unitId:a.key,endTime:j()(n[1]).format("YYYY/MM"),startTime:j()(n[0]).format("YYYY/MM")}:{endTime:j()(n[1]).format("YYYY/MM"),startTime:j()(n[0]).format("YYYY/MM")}:o["a"].error("\u67e5\u8be2\u65e5\u671f\u4e0d\u80fd\u4e3a\u7a7a"),fetch(Object(ee["e"])("/api/stats/histogram/export?".concat(Object(te["stringify"])(e))),l).then(function(e){e.blob().then(function(e){try{Object(ee["a"])(e,"\u6848\u5377\u7edf\u8ba1.xlsx")}catch(e){console.log(e),o["a"].error("failed")}})})})}},{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;t({type:"fileStat/fetch_getSelectList",callback:function(a){t({type:"fileStat/fetch_getSelectList",payload:{id:a[0].key},callback:function(t){e.getBarData(t)}})}})}},{key:"componentWillUnmount",value:function(){this.setState({isBreakpoint:!1})}},{key:"render",value:function(){var e=this.props,t=(e.form.getFieldDecorator,e.fileStat),a=(t.fileStatData,t.selectList),o=this.state,l=o.barData,s=o.rangePickerValue,c=o.bottomLoading;return T.a.createElement("div",{className:B.a.div_warp},T.a.createElement(n["a"],{bodyStyle:{padding:0,margin:0},style:{background:"#fff"},bordered:!1},T.a.createElement(r["a"],{type:"flex",justify:"center",style:{padding:"50px 0",borderBottom:"1px solid #cdcdcd"}},T.a.createElement(M["a"],{className:B.a.fileStateFormWarp,style:{display:"flex",justifyContent:"space-around",width:"50%"}},T.a.createElement(ae,{value:s,placeholder:[j()().format("YYYY/MM"),j()().format("YYYY/MM")],format:"YYYY-MM",mode:["month","month"],showTime:!0,onPanelChange:this.handlePanelChange,onChange:this.handleChange}),T.a.createElement(R,{onSelect:this.selectComponentOnSelect,selectDataSource:a,style:{width:"35%"}}),T.a.createElement(i["a"],{type:"primary",style:{marginTop:1},onClick:this.handleOnSearch,loading:c},"\u67e5\u8be2"),T.a.createElement(i["a"],{type:"primary",style:{marginTop:1},onClick:this.handleDownload},"\u5bfc\u51fa")))),l.map(function(e){return T.a.createElement(X,{key:e.unit.id,dataSource:e})}))}}]),t}(O["PureComponent"]),G=K))||G)||G);t["default"]=ne}}]);